#!/bin/sh

WALLPAPER="$(cat "$HOME/.cache/current_wallpaper" 2>/dev/null)"
[ -f "$WALLPAPER" ] || exit 0

BRIGHTNESS=$(magick "$WALLPAPER" -colorspace gray -resize 1x1 txt:- \
  | awk -F '[(),]' '/gray/ {print int($4)}')

if [ "$BRIGHTNESS" -lt 80 ]; then
  BLUR=14
elif [ "$BRIGHTNESS" -lt 130 ]; then
  BLUR=8
else
  BLUR=4
fi

swaymsg blur_radius "$BLUR" >/dev/null

